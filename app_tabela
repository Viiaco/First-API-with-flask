import requests
from bs4 import BeautifulSoup
from flask import Flask, jsonify, Response
import pandas as pd

url_prod = 'http://vitibrasil.cnpuv.embrapa.br/index.php?opcao=opt_02'

app = Flask(__name__)

def get_table_data(url):
    response = requests.get(url)
    if response.status_code == 200:
        soup = BeautifulSoup(response.content, 'html.parser')
        table = soup.find('table', {'class': 'tb_base tb_dados'})
        if table:
            rows = table.find_all('tr')
            data = []
            for row in rows:
                cells = row.find_all(['th', 'td'])
                cells_text = [cell.get_text(strip=True) for cell in cells]
                data.append(cells_text)
            return data
        else:
            print("Tabela não encontrada na página.")
            return None
    else:
        print(f"Erro ao acessar a página: {response.status_code}")
        return None

data = get_table_data(url_prod)
if data:
    df = pd.DataFrame(data[1:], columns=data[0])
    print(df.head())
else:
    print("Erro ao obter dados da tabela")
